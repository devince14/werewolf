# 狼人杀人机对战模式说明

## 功能概述

在原有AI自动对战功能的基础上，新增了人机对战模式，允许一个人类玩家与其他AI玩家进行游戏。

## 主要特性

### 1. 模式选择
- **AI自动对战**：保持原有功能，所有玩家都是AI
- **人机对战**：一个人类玩家 + 其他AI玩家

### 2. 人类玩家交互
在人机对战模式下，人类玩家可以在各个阶段进行以下操作：

#### 夜晚阶段
- **狼人**：选择击杀目标或不杀人
- **预言家**：选择查验目标或不查验
- **村民**：无夜晚行动

#### 发言阶段
- **声称预言家**：声明自己是预言家
- **声称好人**：声明自己是好人
- **指控某人是狼**：指控某个玩家是狼人
- **支持某人是好人**：支持某个玩家是好人
- **保持沉默**：不发言

#### 投票阶段
- 选择投票目标或弃票

### 3. 信息隐藏机制
- **AI模式**：显示所有玩家角色和AI信念值（观战模式）
- **人机模式**：
  - 人类玩家只能看到自己的真实角色
  - 其他玩家角色显示为"身份未知"
  - 不显示AI玩家的信念值
  - 只能看到公共信息（发言、投票、死亡等）
- AI玩家仍使用原有的策略系统，但对人类玩家隐藏

## 文件结构

```
webapp/
├── app.py                  # 主应用文件，集成两种模式
├── human_ai_game.py        # 人机对战逻辑处理器
├── templates/
│   └── index.html          # 前端界面，包含模式选择和人类玩家操作面板
└── README_人机对战.md      # 本说明文档
```

## 使用方法

1. 启动应用：`python app.py`
2. 打开浏览器访问 `http://localhost:5000`
3. 选择游戏模式：
   - 点击"AI自动对战"：传统的AI对战模式
   - 点击"人机对战"：进入人机对战设置
4. 在人机对战设置中：
   - 设置玩家人数、狼人数量等参数
   - 选择人类玩家位置（玩家1-玩家N）
   - 选择AI策略（目前支持信念策略）
5. 开始游戏后：
   - 轮到人类玩家时，会弹出操作选择界面
   - 根据当前阶段选择相应的行动
   - AI玩家会自动执行行动

## 技术实现

### 后端逻辑
- `HumanAIGameHandler`类负责处理人机交互
- 在原有游戏流程中插入人类玩家等待逻辑
- 通过WebSocket实时通信

### 前端界面
- Vue.js响应式界面
- 模态对话框处理人类玩家操作
- 实时显示AI玩家的信念值

### 游戏流程控制
- AI模式：完全自动进行
- 人机模式：在人类玩家回合暂停，等待操作完成后继续

## 注意事项

1. 人类玩家的角色是随机分配的（或按设置的位置）
2. 只能同时有一个人类玩家
3. 人类玩家的操作会实时影响AI玩家的信念判断
4. 游戏仍遵循原有的狼人杀规则和胜负条件
5. **重要**：在人机模式下，人类玩家只能看到公共信息，无法看到AI玩家的真实角色和内心信念，这保证了游戏的公平性和真实感

## 信息可见性对比

| 信息类型 | AI对战模式 | 人机对战模式 |
|---------|-----------|-------------|
| 所有玩家角色 | ✅ 可见 | ❌ 只能看到自己的角色 |
| AI玩家信念值 | ✅ 可见 | ❌ 不可见 |
| 夜晚行动细节 | ✅ 可见 | ❌ 不可见 |
| 公共发言 | ✅ 可见 | ✅ 可见 |
| 投票结果 | ✅ 可见 | ✅ 可见 |
| 死亡信息 | ✅ 可见（含角色） | ✅ 可见（不含角色） |
| 预言家查验结果 | ✅ 可见 | ⚠️ 只能看到自己的查验结果 |

## 最新修复

### 修复内容
1. **死亡信息隐藏**：在人机模式下，死亡公告不再显示死者的真实角色
2. **发言流程修复**：修复了人类玩家发言后游戏停止的问题，现在会自动继续到下一位玩家
3. **状态显示**：前端界面会正确显示玩家的存活状态

### Bug修复记录
- ✅ 修复死亡玩家角色泄露问题
- ✅ 修复人类发言后游戏流程中断问题  
- ✅ 修复玩家死亡状态显示问题
- ✅ 完善游戏结束时的角色显示逻辑 