# 强化学习功能总结

## 🎯 功能概述

平台近期将添加强化学习模型支持，允许用户上传训练好的模型文件，让智能体使用训练好的策略进行游戏。
或者，用户可以在源码进行代码编辑，进行上传。

## ✨ 预计新增功能

### 1. 模型文件上传
- **支持格式**: `.pkl`, `.pth`, `.h5`, `.pt`, `.model`, `.weights`
- **文件大小限制**: 50MB
- **上传位置**: 个人资料页面的"模型管理"部分
- **安全存储**: 文件存储在独立的`models`目录中

### 2. 模型管理界面
- **上传功能**: 拖拽或点击上传模型文件
- **文件列表**: 显示所有上传的模型文件
- **文件信息**: 显示文件名、大小、类型、上传时间
- **删除功能**: 支持删除不需要的模型文件
- **状态检查**: 显示文件是否存在

### 3. 强化学习智能体模板
- **自动加载**: 智能体自动查找并加载用户的模型文件
- **多格式支持**: 支持sklearn、PyTorch、TensorFlow、joblib等格式
- **错误处理**: 模型加载失败时使用默认策略
- **特征提取**: 标准化的28维特征向量
- **行动转换**: 自动将模型输出转换为环境行动

### 4. 数据库支持
- **ModelFile表**: 存储模型文件信息
- **用户关联**: 每个用户只能管理自己的模型文件
- **文件追踪**: 记录文件名、大小、类型、上传时间

## 📁 文件结构

```
competition_template/
├── models/                    # 模型文件存储目录
├── agents_user/              # 用户代码文件
├── app.py                    # 主应用（已更新）
├── models.py                 # 数据库模型（已更新）
├── requirements.txt          # 依赖包（已更新）
├── rl_agent_template.py     # 强化学习智能体模板
├── test_rl_agent.py         # 测试脚本
├── create_example_model.py  # 示例模型生成脚本
├── README_强化学习使用指南.md  # 详细使用指南
└── README_强化学习功能总结.md  # 本文档
```

## 🔧 技术实现

### 后端API
- `POST /upload_model` - 上传模型文件
- `GET /list_models` - 获取用户模型列表
- `DELETE /delete_model/<id>` - 删除模型文件

### 前端界面
- 个人资料页面添加"模型管理"部分
- 文件上传界面（支持拖拽）
- 模型文件列表显示
- 实时状态反馈

### 智能体集成
- 自动模型发现和加载
- 多格式模型支持
- 标准化特征提取
- 智能行动转换

## 📊 特征设计

### 输入特征（28维）
1. **基本信息** (8维)
   - agent_id, num_agents
   - is_wolf, is_seer, is_villager
   - is_talk_stage, is_vote_stage, is_night_stage

2. **存活状态** (5维)
   - 每个玩家的存活状态

3. **游戏历史** (15维)
   - 最近5轮发言信息
   - 每轮：发言者、发言类型、目标

### 输出行动
- **talk阶段**: [claim_seer, talk_type, target]
- **vote阶段**: [target]
- **night阶段**: [target]

## 🚀 使用流程

### 1. 准备模型文件
```bash
# 创建示例模型
python create_example_model.py
```

### 2. 上传模型
1. 登录平台
2. 进入个人资料页面
3. 在"模型管理"部分上传模型文件

### 3. 编写智能体代码
使用`rl_agent_template.py`中的模板，或参考使用指南

### 4. 提交评测
系统会自动加载您的模型并进行评测

## ⚠️ 注意事项

### 模型要求
- 必须在CPU上运行
- 推理速度要快（影响评测速度）
- 文件大小不超过50MB

### 依赖包
```bash
pip install torch tensorflow scikit-learn joblib
```

### 错误处理
- 模型加载失败时使用默认策略
- 检查控制台输出了解错误信息
- 确保模型格式正确

## 🎮 示例用法

### 简单的sklearn模型
```python
from sklearn.ensemble import RandomForestClassifier
import pickle

# 训练模型
model = RandomForestClassifier()
model.fit(X_train, y_train)

# 保存模型
with open('my_model.pkl', 'wb') as f:
    pickle.dump(model, f)
```

### PyTorch模型
```python
import torch

# 训练模型
model = MyNeuralNetwork()
# ... 训练过程 ...

# 保存模型
torch.save(model, 'my_model.pth')
```

## 🔍 测试功能

### 运行测试
```bash
python test_rl_agent.py
```

### 测试内容
1. 模型文件创建
2. 模型加载功能
3. 智能体基本功能
4. 多格式支持

## 📈 性能优化建议

### 模型优化
- 使用模型压缩技术
- 减少模型复杂度
- 使用更快的推理框架

### 特征工程
- 根据游戏特点设计特征
- 实验不同的特征组合
- 考虑添加更多游戏状态信息

### 训练策略
- 使用自对弈训练
- 平衡探索和利用
- 定期更新模型

## 🎯 未来扩展

### 可能的改进
1. **模型版本管理**: 支持模型版本控制
2. **模型性能分析**: 显示模型在不同场景下的表现
3. **自动超参数调优**: 集成超参数优化工具
4. **模型可视化**: 提供模型结构可视化
5. **分布式训练**: 支持分布式模型训练

### 新功能
1. **模型市场**: 用户间分享模型
2. **模型评估**: 更详细的模型性能评估
3. **在线学习**: 支持在线模型更新
4. **模型解释**: 提供模型决策解释

## 📝 总结

强化学习功能的成功添加为平台带来了以下价值：

1. **扩展性**: 支持多种深度学习框架
2. **易用性**: 简单的上传和使用流程
3. **兼容性**: 与现有系统无缝集成
4. **安全性**: 用户隔离和文件安全检查
5. **可维护性**: 清晰的代码结构和文档

这个功能为有强化学习背景的用户提供了展示和测试他们训练模型的机会，同时也为其他用户提供了学习和参考的素材。

🎉 **平台现在支持完整的强化学习工作流程！**